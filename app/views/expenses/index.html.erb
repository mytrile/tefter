
<%= render :partial => 'expenses/form' %>

<div id="main">
  <div id="expenses">
    <% if @category -%>
      <h2>Expenses marked as <%=h @category.name -%></h2>
    <% else -%>
      <h2>Recent expenses:</h2>
    <% end -%>
    <table>
      <colgroup>
        <col width="15%" />
        <col width="60%" />
        <col width="25%" />
      </colgroup>
      <tbody>
        <% date = nil %>
        <% @expenses.each do |expense| -%>
          <% if date != expense.created_at -%>
            <% date = expense.created_at -%>
            <tr class="date"> <td colspan="2"><%= date.to_s(:short) %></td> <td class="price"><%=to_money @totals[date] %></td> </tr>
          <% end -%>
          <tr> 
            <td class="category"><%= link_to_category(expense.category) -%></td> 
            <td><%= link_to_edit_expense expense -%></td> 
            <td class="price"><%= to_money expense.amount %></td> 
          </tr>
        <% end -%>
      </tbody>
    </table>
    <%= will_paginate @expenses -%>
  </div>

  <div id="stats">
    <h2>How am I going?</h2>
    <% @stats.each do |month, categories| -%>
      <table summary="Expenses for <%= month %>">
        <thead>
          <tr><th><%= month %></th> <th class="price"><%=to_money categories.values.sum %></th> </tr>
        </thead>
        <tbody>
          <% categories.each do |category, amount| -%>
            <tr>
              <td class="category"><%= link_to_category(category) -%></td>
              <td class="price"><%= to_money amount %></td>
            </tr>
          <% end -%>
        </tbody>
      </table>
    <% end -%>
  </div>
  <br style="clear:both" />
</div>

